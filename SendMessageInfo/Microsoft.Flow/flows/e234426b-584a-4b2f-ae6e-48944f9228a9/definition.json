{"name":"7f8ed54b-81d8-4e12-b76b-97cf53132216","id":"/providers/Microsoft.Flow/flows/7f8ed54b-81d8-4e12-b76b-97cf53132216","type":"Microsoft.Flow/flows","properties":{"apiId":"/providers/Microsoft.PowerApps/apis/shared_logicflows","displayName":"SendMessageInfo","definition":{"metadata":{"workflowEntityId":null,"processAdvisorMetadata":null,"flowclientsuspensionreason":"None","flowclientsuspensiontime":null,"creator":{"id":"5bfcd121-0028-48de-85f4-bcfd14cc1005","type":"User","tenantId":"7f8d27e7-be70-4bed-83d5-97be9ab7e711"},"provisioningMethod":"FromDefinition","failureAlertSubscription":true,"clientLastModifiedTime":"2022-02-16T12:11:27.573675Z"},"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"1.0.0.0","parameters":{"$connections":{"defaultValue":{},"type":"Object"},"$authentication":{"defaultValue":{},"type":"SecureObject"}},"triggers":{"manual":{"splitOn":"@triggerBody()['rows']","metadata":{"flowSystemMetadata":{"swaggerOperationId":"ForASelectedMessage","taskModuleWidth":null,"taskModuleHeight":null,"inputsAdaptiveCard":"{\"type\":\"AdaptiveCard\",\"$schema\":\"http://adaptivecards.io/schemas/adaptive-card.json\",\"version\":\"1.2\",\"body\":[{\"type\":\"TextBlock\",\"text\":\"対象リンクをチャットします。\"},{\"text\":\"Cancelは右上の❎\",\"type\":\"TextBlock\",\"horizontalAlignment\":\"Right\",\"weight\":\"Lighter\",\"size\":\"Small\",\"color\":\"Attention\"}],\"-ms-tokens\":{}}"},"operationMetadataId":"18c9d3d7-1156-4520-9987-1aab76e90490"},"type":"Request","kind":"ApiConnection","inputs":{"schema":{"type":"object","properties":{"rows":{"type":"array","items":{"type":"object","properties":{"entity":{"type":"object","properties":{"teamsFlowRunContext":{"type":"object","properties":{"from":{"type":"object","properties":{"aadObjectId":{"title":"Originating User ID","type":"string"}},"required":[]},"messagePayload":{"type":"object","properties":{"from":{"type":"object","properties":{"conversation":{"title":"conversation","type":"object"}},"required":[]}},"required":[]},"conversation":{"title":"conversation","type":"object","properties":{"name":{"title":"Conversation Name","type":"string"}},"required":[]}}}},"required":["teamsFlowRunContext"]}},"required":["entity"]}}},"required":["rows"]},"host":{"connection":{"name":"@parameters('$connections')['shared_teams']['connectionId']"},"api":{"runtimeUrl":"https://japan-001.azure-apim.net/apim/teams"}},"operationId":"ForASelectedMessage","parameters":{"inputsAdaptiveCard":"{\"type\":\"AdaptiveCard\",\"$schema\":\"http://adaptivecards.io/schemas/adaptive-card.json\",\"version\":\"1.2\",\"body\":[{\"type\":\"TextBlock\",\"text\":\"対象リンクをチャットします。\"},{\"text\":\"Cancelは右上の❎\",\"type\":\"TextBlock\",\"horizontalAlignment\":\"Right\",\"weight\":\"Lighter\",\"size\":\"Small\",\"color\":\"Attention\"}],\"-ms-tokens\":{}}"}}}},"actions":{"Post_message_in_a_chat_or_channel":{"runAfter":{"Parse_JSON_Conversation":["Succeeded"]},"metadata":{"operationMetadataId":"4d8ddeba-2bc5-4c29-ae50-328118ef3464"},"type":"OpenApiConnection","inputs":{"host":{"apiId":"/providers/Microsoft.PowerApps/apis/shared_teams","connectionName":"shared_teams","operationId":"PostMessageToConversation"},"parameters":{"poster":"Flow bot","location":"Chat with Flow bot","body/recipient":"@{triggerBody()?['entity']?['teamsFlowRunContext']?['from']?['aadObjectId']};","body/messageBody":"<p><a href=\"@{triggerBody()?['entity']?['teamsFlowRunContext']?['messagePayload']?['linkToMessage']}\">リンク元へ</a></p>\n<p>@{triggerBody()?['entity']?['teamsFlowRunContext']?['messagePayload']?['subject']}</p>\n<BLOCKQUOTE>@{triggerBody()?['entity']?['teamsFlowRunContext']?['messagePayload']?['body']?['content']}</BLOCKQUOTE>\n<table border = \"1\" cellspacing=\"1\"  align=\"center\" style=\"border: 1px ;color:silver;\">\n　<tr style=\"vertical-align: middle;\">\n　　<td>Team ID</td>\n　　<td>@{triggerBody()?['entity']?['teamsFlowRunContext']?['channelData']?['team']?['aadGroupId']}</td>\n　</tr>\n　<tr  style=\"vertical-align: middle;\">\n　　<td>Channel ID</td>\n　　<td>@{triggerBody()?['entity']?['teamsFlowRunContext']?['channelData']?['channel']?['id']}</td>\n　</tr>\n　<tr  style=\"vertical-align: middle;\">\n　　<td>Message ID</td>\n　　<td>@{triggerBody()?['entity']?['teamsFlowRunContext']?['messagePayload']?['id']}</td>\n　</tr>\n\n　<tr  style=\"vertical-align: middle;\">\n　　<td>Conversation Name</td>\n　　<td>@{triggerBody()?['entity']?['teamsFlowRunContext']?['conversation']?['name']}</td>\n　</tr>\n　<tr  style=\"vertical-align: middle;\">\n　　<td>Conversation ID</td>\n　　<td>@{body('Parse_JSON_Conversation')?['Id']}</td>\n　</tr>\n　<tr  style=\"vertical-align: middle;\">\n　　<td>Is Group</td>\n　　<td>@{body('Parse_JSON_Conversation')?['IsGroup']}</td>\n　</tr>\n</table>\n"},"authentication":{"value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']","type":"Raw"}}},"Parse_JSON_Conversation":{"runAfter":{},"metadata":{"operationMetadataId":"23774de2-2582-4eaf-b646-54b7d1c85fa8"},"type":"ParseJson","inputs":{"content":"@triggerBody()?['entity']?['teamsFlowRunContext']?['conversation']","schema":{"type":"object","properties":{"entity":{"type":"object","properties":{"teamsFlowRunContext":{"type":"object","properties":{"MessagePayload":{"type":"object","properties":{"Id":{"type":"string"},"From":{"type":"object","properties":{"Application":{},"Conversation":{},"Device":{},"User":{"type":["null","object"],"properties":{"DisplayName":{"type":"string"},"Id":{"type":"string"}}}}},"Body":{"type":"object","properties":{"ContentType":{"type":"string"},"Content":{"type":"string"},"PlainText":{"type":["null","string"]}}},"Subject":{},"LinkToMessage":{"type":"string"}}},"Id":{"type":"string"},"ChannelData":{"type":"object","properties":{"EventType":{},"InvalidateInvokeCache":{},"Team":{"type":["object","null"],"properties":{"Id":{"type":"string"},"AadGroupId":{"type":"string"},"Name":{}}},"Tenant":{"type":"object","properties":{"Id":{"type":"string"}}},"Channel":{"type":["object","null"],"properties":{"Id":{"type":"string"},"Name":{}}},"Notification":{},"OnBehalfOf":{}}},"From":{"type":"object","properties":{"Id":{"type":"string"},"Name":{"type":"string"},"Role":{},"AadObjectId":{"type":"string"},"Properties":{}}},"Conversation":{"type":"object","properties":{"Id":{"type":"string"},"Name":{"type":["string","null"]},"IsGroup":{"type":["boolean","null"]}}},"Locale":{"type":"string"},"CommandContext":{"type":"string"},"LocalTimezone":{"type":"string"}}},"cardOutputs":{"type":"object","properties":{}}}}}}}}}},"connectionReferences":{"shared_teams":{"connectionName":"shared-teams-864099d5-54a7-4002-93b6-565ecf481128","source":"Invoker","id":"/providers/Microsoft.PowerApps/apis/shared_teams","tier":"NotSpecified"}},"flowFailureAlertSubscribed":false}}